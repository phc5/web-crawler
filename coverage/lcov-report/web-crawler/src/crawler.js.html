<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for web-crawler\src\crawler.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">all files</a> / <a href="index.html">web-crawler/src/</a> crawler.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.12% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>78/82</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">86.36% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>38/44</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>11/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.12% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>78/82</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">35104×</span>
<span class="cline-any cline-yes">35103×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">35103×</span>
<span class="cline-any cline-yes">33364×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1739×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1739×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1739×</span>
<span class="cline-any cline-yes">1739×</span>
<span class="cline-any cline-yes">1739×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1739×</span>
<span class="cline-any cline-yes">1739×</span>
<span class="cline-any cline-yes">34×</span>
<span class="cline-any cline-yes">34×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-yes">3410×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-yes">1071×</span>
<span class="cline-any cline-yes">35104×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">35102×</span>
<span class="cline-any cline-yes">35102×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">3410×</span>
<span class="cline-any cline-yes">3410×</span>
<span class="cline-any cline-yes">2755×</span>
<span class="cline-any cline-yes">24639×</span>
<span class="cline-any cline-yes">19107×</span>
<span class="cline-any cline-yes">807×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">807×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18300×</span>
<span class="cline-any cline-yes">17737×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">563×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1705×</span>
<span class="cline-any cline-yes">1693×</span>
<span class="cline-any cline-yes">14290×</span>
<span class="cline-any cline-yes">1694×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1693×</span>
<span class="cline-any cline-yes">1685×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span></td><td class="text"><pre class="prettyprint lang-js">/**
 * crawler.js is a simple web crawler that will visit every reachable page from a starting URL. This web crawler should
 * not cross subdomains. For example, when crawling http://www.example.com, it should not crawl http://mail.example.com. For
 * each page, this crawler should determine the URL of every static asset on that page. Static assets include images, javascript
 * files, and CSS stylesheets. This crawler should output to console in JSON format a list of all static assets grouped by 
 * what page they were found on.
 * 
 * @summary crawler.js is a simple web crawler that will get all static assets for every reachable page from a starting URL.
 *
 * author - Paul Chong
 * date - Monday, February 27, 2017
 */
&nbsp;
const request = require('request');
const URL = require('url-parse');
const cheerio = require('cheerio');
const fs = require('fs');
&nbsp;
let pagesVisited = [];
let pagesToVisit = [];
let resultArray = [];
let baseURL = null;
let pageVisited = 0;
let urlNoProtocol = null; 
let count = 0;
const srcArray = ['img', 'script'];
&nbsp;
/**
 * checkURL() will take in a string input and test if it is a valid URL with protocal and hostname
 * by using regex.
 * 
 * @param {Srting} urlInput - a string 
 * @return {Boolean} true - if urlInput is a URL -OR- false - if urlInput is not a URL
 */
const checkURL = function(urlInput) {
	let isValidURL = /^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[\:?\d]*)\S*$/;
	let url = new URL(urlInput);
&nbsp;
	<span class="missing-if-branch" title="else path not taken" >E</span>if (isValidURL.test(url)) {
		baseURL = url.protocol + '//' + url.hostname;
		pagesToVisit.push(baseURL + '/');
		return true;
	}
<span class="cstat-no" title="statement not covered" >	return false;</span>
}
&nbsp;
/**
 * crawl() will go through the pagesToVisit array, skipping over pages that have been already been visited, and push 
 * an object to the resultArray. If there are no pages in pagesToVisit, then this function will write to an output.txt
 * file in the project directory.
 */
const crawl = function() {
	if (pagesToVisit.length &gt; 0) {
		let nextPage = pagesToVisit.pop();
&nbsp;
		if (nextPage in pagesVisited) {
			crawl();
		} else {
			resultArray.push({
				url: nextPage,
				assets: []
			});
			visitPage(nextPage, crawl);
		}
	} else <span class="missing-if-branch" title="else path not taken" >E</span>if (pagesToVisit.length == 0) {	
		fs.writeFile('./output.txt', JSON.stringify(resultArray, null, 2), function(error) {
			<span class="missing-if-branch" title="if path not taken" >I</span>if (error) {
<span class="cstat-no" title="statement not covered" >				console.error('Write error:', error.message);</span>
			} else {
				console.log('Write success to output.txt');
				process.exit();
			}
		});
	}
}
&nbsp;
/**
 * visitPage() will make an HTTP request to the given URL, call getSources() and getStylesheets() on the response body, 
 * and go through all relative links of the given URL and push them into the pagesToVisit array.
 *
 * @param {String} url
 * @param {Object} callback
 */
function visitPage(url, callback) {
	pagesVisited[url] = true;
	count++;
	console.log(count + " Visiting page " + url);
&nbsp;
	request(url, function(error, response, body) {
		if (error || response.statusCode !== 200) {
			callback();
			return;
		}
&nbsp;
		// stackoverflow.com/questions/3999764/taking-off-the-http-or-https-off-a-javascript-string
		urlNoProtocol = baseURL.replace(/^https:?\:\/\//i,"");
&nbsp;
		let $ = cheerio.load(body);
		for (let i = 0 ; i &lt; srcArray.length; i++) {
			getSources(body, srcArray[i], $);
		}
		getStylesheets(body, $);
&nbsp;
		getRelativeLinks(body, $);
		
		pageVisited++;
		callback();
	})
}
&nbsp;
function getRelativeLinks(body, $) {	
	let relativeLinks = $("a[href^='/']");		
	if (relativeLinks.length &gt; 0) {
		relativeLinks.each(function() {
			if ($(this).attr('href')[0] + $(this).attr('href')[1] === '//') {
				<span class="missing-if-branch" title="if path not taken" >I</span>if ($(this).attr('href').slice(2) === urlNoProtocol + $(this).attr('href').slice(urlNoProtocol.length + 2)) {
<span class="cstat-no" title="statement not covered" >					pagesToVisit.push($(this).attr('href').slice(2));</span>
				}
			} else <span class="missing-if-branch" title="else path not taken" >E</span>if ($(this).attr('href')[0] === '/' &amp;&amp; $(this).attr('href')[1] !== '/') {
				pagesToVisit.push(baseURL + $(this).attr('href'));
			}
		});
	}
}
&nbsp;
&nbsp;
/**
 * getSources() will go through the given body and search for the given tag and push all 'src's into the the current
 * page's assets array in the resultArray.
 *
 * @param {String} body
 * @param {String} tag
 */
function getSources(body, tag, $) {
	let sourceLinks = $(tag);
	if (sourceLinks.length &gt; 0) {
		sourceLinks.each(function() {
			if ($(this).attr('src')) {
				if ($(this).attr('src')[0] + $(this).attr('src')[1] === '//') {
					<span class="missing-if-branch" title="if path not taken" >I</span>if ($(this).attr('src').slice(2) === urlNoProtocol + $(this).attr('src').slice(urlNoProtocol.length + 2)) {
<span class="cstat-no" title="statement not covered" >						resultArray[pageVisited].assets.push($(this).attr('src').slice(2));</span>
					} else {
						resultArray[pageVisited].assets.push($(this).attr('src').slice(2));
					}
				} else if ($(this).attr('src')[0] === '/') {
					resultArray[pageVisited].assets.push(baseURL + $(this).attr('src'));
				} else {
					resultArray[pageVisited].assets.push($(this).attr('src'));
				}
			}
		});
	}
}
&nbsp;
/**
 * getStylesheets() will go through the given body and search for the link tag and push all 'href's into the current
 * page's assets array in the resultArray.
 *
 * @param {String} body
 */
function getStylesheets(body, $) {
	let stylesheetLinks = $('link');
&nbsp;
	if (stylesheetLinks.length &gt; 0) {
		stylesheetLinks.each(function() {
			if ($(this).attr('href') &amp;&amp; $(this).attr('rel') === 'stylesheet') {
				if ($(this).attr('href')[0] + $(this).attr('href')[1] === '//') {
					resultArray[pageVisited].assets.push($(this).attr('href').slice(2));
				} else if ($(this).attr('href')[0] === '/') {
					resultArray[pageVisited].assets.push(baseURL + $(this).attr('href'));
				} else {
					resultArray[pageVisited].assets.push($(this).attr('href'));
				}
			}
		});
	}
}
&nbsp;
exports.checkURL = checkURL;
exports.crawl = crawl;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Mar 04 2017 11:39:12 GMT-0800 (Pacific Standard Time)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
